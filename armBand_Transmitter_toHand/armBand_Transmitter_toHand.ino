#include <esp_now.h>
#include <WiFi.h>
#include <Wire.h>

uint8_t broadcastAddress[] = {0x6C, 0xC8, 0x40, 0x8A, 0x89, 0x58};

typedef struct struct_message {
  
    float Adest;
    float Bdest;
    float Cdest;
    float Ddest;
    float Edest;
    float Fdest;

} 
struct_message;
struct_message myData;
esp_now_peer_info_t peerInfo;

void OnDataSent(const uint8_t *mac_addr, esp_now_send_status_t status) {
  Serial.print("\r\nLast Packet Send Status:\t");
  Serial.println(status == ESP_NOW_SEND_SUCCESS ? "Delivery Success" : "Delivery Fail");
}

int manhDist(int trainPoint[], int newPoint[]){
  int dist = 0;
  for(int i=0;i<16;i++){
    dist = dist + abs(trainPoint[i]-newPoint[i]);
  }

  return (dist);
}

//pressure array variables
int line1 = 35;
int line2 = 34;
int line3 = 39;

int output1 = 13;
int output2 = 12;
int output3 = 14;
int output4 = 27;
int output5 = 26;
int output6 = 25;
int output7 = 33;
int output8 = 32;

int pressure1 = 0;
int pressure2 = 0;
int pressure3 = 0;

int avg;
int completeArray[16];


int trainData[200][16]= {

    {0,0,523,218,455,229,298,429,244,142,0,0,154,0,349,187},
    {0,0,284,98,350,402,326,289,386,459,0,0,347,80,456,291},
    {0,0,388,145,479,287,397,368,485,283,0,0,232,16,453,331},
    {0,0,448,176,419,270,417,432,394,190,0,0,143,0,386,217},
    {0,0,432,181,479,222,272,435,278,129,0,0,186,0,335,167},
    {0,0,264,102,361,440,343,291,373,432,0,0,326,87,427,287},
    {0,0,437,173,477,279,400,373,455,270,0,0,197,12,464,343},
    {0,0,492,208,433,286,422,422,404,199,0,0,176,0,358,214},
    {0,0,492,205,544,231,240,449,339,145,0,0,190,0,336,176},
    {0,0,255,87,365,441,341,302,383,432,0,0,323,46,443,273},
    {0,0,436,165,495,271,419,422,469,257,0,0,208,2,511,385},
    {0,0,463,185,475,291,395,432,381,185,0,0,177,0,366,222},
    {0,0,507,199,599,257,240,447,287,144,0,0,129,0,330,163},
    {0,0,275,107,351,434,316,291,355,403,0,0,305,75,416,272},
    {0,0,431,161,468,279,361,368,478,265,0,0,210,4,507,354},
    {0,0,446,167,431,240,400,447,368,176,0,0,166,0,404,242},
    {0,0,510,201,549,240,251,417,352,162,0,0,191,0,314,181},
    {0,0,272,129,357,433,304,290,359,397,0,0,297,79,433,287},
    {0,0,450,177,484,240,286,387,448,245,0,0,223,13,470,317},
    {0,0,450,195,424,272,389,410,409,158,0,0,160,0,384,214},


    {0,0,510,189,579,243,249,419,304,155,0,0,166,0,325,187},
    {0,0,294,97,401,407,320,274,390,451,0,0,318,71,448,301},
    {0,0,445,179,499,293,368,386,466,253,0,0,217,11,483,349},
    {0,0,449,188,484,305,379,422,415,187,0,0,176,0,365,229},
    {0,0,528,199,501,240,256,424,304,146,0,0,178,0,318,192},
    {0,0,294,96,370,427,310,286,383,432,0,0,325,72,474,311},
    {0,0,418,169,480,288,347,369,438,230,0,0,229,22,511,339},
    {0,0,389,174,461,289,388,398,413,179,0,0,177,0,384,240},
    {0,0,255,186,585,261,378,405,325,186,0,0,227,0,429,205},
    {0,0,237,80,336,409,385,264,310,432,0,0,354,78,409,318},
    {0,0,351,159,463,336,487,388,364,276,0,0,274,29,431,304},
    {0,0,177,110,591,333,496,460,272,180,0,36,397,54,354,176},
    {0,0,231,115,598,282,391,470,273,151,0,0,314,0,399,144},
    {0,0,249,98,338,381,371,267,301,427,0,0,351,94,382,304},
    {0,0,275,122,470,350,523,375,359,304,0,0,333,26,415,323},
    {0,0,163,87,511,362,620,442,330,198,0,0,454,78,368,191},
    {0,0,265,143,590,277,425,481,293,182,0,0,255,0,395,170},
    {0,0,239,90,371,415,387,267,315,427,0,0,340,84,425,315},
    {0,0,315,144,490,320,480,368,361,290,0,0,374,55,418,327},
    {0,0,131,80,506,338,598,423,357,222,0,0,429,73,405,207},


    {0,0,246,134,645,265,400,477,288,160,0,0,285,2,358,161},
    {0,0,238,82,336,376,354,268,291,400,0,0,328,100,366,302},
    {0,0,284,146,510,314,464,377,366,278,0,0,395,58,400,304},
    {0,0,133,83,511,336,592,426,389,226,0,0,464,85,374,208},
    {0,0,246,138,577,230,422,496,369,191,0,0,261,2,400,174},
    {0,0,224,47,352,379,368,269,306,397,0,0,329,80,349,322},
    {0,0,279,124,502,311,473,390,368,275,0,0,400,25,409,304},
    {0,0,172,90,505,327,594,426,337,220,0,0,464,79,390,212},
    {0,0,241,134,615,257,400,487,307,173,0,0,251,0,379,171},
    {0,0,237,106,355,381,369,263,315,404,0,0,336,96,387,301},
    {0,0,304,144,542,328,464,382,398,291,0,0,411,71,442,310},
    {0,0,144,80,559,350,573,454,355,244,0,0,496,87,381,222},
    {0,0,250,138,644,246,403,496,313,172,0,0,366,32,394,178},
    {0,0,242,112,350,396,359,240,313,401,0,0,343,94,388,303},
    {0,0,267,128,488,320,440,365,368,272,0,0,448,80,417,304},
    {0,0,107,64,508,346,592,415,366,208,0,0,528,96,432,220},
    {0,0,227,128,602,252,379,464,368,176,0,0,400,37,370,173},
    {0,0,230,104,336,396,354,246,293,381,0,0,326,102,364,304},
    {0,0,298,146,554,327,489,385,374,257,0,0,428,68,427,286},
    {0,0,104,55,587,365,599,463,366,234,0,0,561,112,354,214},


    {0,0,384,218,628,274,373,464,276,161,0,0,160,0,407,205},
    {0,0,267,93,401,415,399,254,365,460,0,0,304,42,400,368},
    {0,0,374,147,490,257,462,406,384,272,0,0,192,0,475,337},
    {0,0,226,128,449,301,598,423,400,256,0,0,336,35,407,240},
    {0,0,371,175,592,243,363,469,364,163,0,0,176,0,419,185},
    {0,0,233,84,354,401,398,272,336,432,0,0,297,67,382,336},
    {0,0,389,179,506,299,434,387,419,259,0,0,262,33,457,320},
    {0,0,208,91,523,348,543,421,412,256,0,0,336,27,421,237},
    {0,0,342,154,624,247,374,511,374,171,0,0,213,0,435,180},
    {0,0,235,95,350,400,390,274,334,415,0,0,299,66,400,339},
    {0,0,375,166,533,320,460,410,400,242,0,0,246,26,446,333},
    {0,0,240,121,510,351,551,403,377,240,0,0,400,28,432,282},
    {0,0,320,164,599,266,356,450,378,174,0,0,128,0,398,198},
    {0,0,254,98,378,389,393,253,342,405,0,0,284,64,403,345},
    {0,0,336,153,506,307,434,390,383,270,0,0,319,33,470,333},
    {0,0,231,112,459,332,589,425,413,225,0,0,351,16,451,263},
    {0,0,335,154,592,272,384,448,386,179,0,0,251,0,373,187},
    {0,0,258,112,336,368,365,266,333,415,0,0,289,70,368,329},
    {0,0,238,150,510,336,496,388,434,266,0,0,273,27,507,331},
    {0,0,212,114,523,355,542,400,448,351,0,0,362,36,427,272},


    {0,0,379,302,625,265,352,451,364,161,0,0,177,0,385,191},
    {0,0,242,98,348,384,377,256,322,395,0,0,287,67,368,335},
    {0,0,344,153,528,301,420,397,402,249,0,0,247,19,485,337},
    {0,0,208,117,485,335,592,423,428,235,0,0,427,58,431,222},
    {0,0,347,158,565,263,383,469,368,180,0,0,240,0,400,180},
    {0,0,240,94,343,375,361,272,321,395,0,0,272,66,368,333},
    {0,0,357,155,535,317,459,384,406,256,0,0,310,34,424,326},
    {0,0,182,126,568,368,565,416,447,244,0,0,413,53,416,289},
    {0,0,257,173,537,210,429,496,294,170,0,0,333,0,378,182},
    {0,0,223,89,363,414,400,289,318,389,0,0,336,78,383,290},
    {0,0,251,106,471,303,531,394,434,263,0,0,377,42,406,314},
    {0,0,58,26,490,332,599,448,350,215,0,0,546,97,393,191},
    {0,0,191,112,562,253,449,492,326,172,0,0,352,19,333,165},
    {0,0,206,74,384,404,417,278,341,399,0,0,369,99,387,289},
    {0,0,235,157,524,294,447,396,461,241,0,0,445,80,430,288},
    {0,0,48,26,525,368,592,411,332,219,0,0,556,94,366,192},
    {0,0,183,112,592,239,443,503,275,147,0,0,463,45,307,165},
    {0,0,221,96,375,425,388,289,349,387,0,0,350,105,383,288},
    {0,0,197,82,491,315,490,402,433,256,0,0,496,90,406,290},
    {0,0,53,43,554,373,646,499,327,197,0,0,549,101,305,163},
  

    {0,0,187,112,569,256,407,465,305,142,0,0,431,31,354,182},
    {0,0,218,95,355,403,367,267,322,367,0,0,350,100,380,274},
    {0,0,263,128,490,266,458,377,445,260,0,0,470,68,382,279},
    {0,0,23,26,496,394,578,417,397,215,0,0,557,98,339,178},
    {0,0,207,117,611,245,377,451,369,180,0,0,393,37,369,201},
    {0,0,234,100,341,400,368,275,326,378,0,0,337,102,373,286},
    {0,0,253,128,470,284,480,382,435,229,0,0,464,83,411,281},
    {0,0,59,47,528,370,629,435,417,216,0,0,561,103,309,138},
    {0,0,231,137,555,256,397,470,338,160,0,0,368,21,357,179},
    {0,0,217,80,355,405,383,268,336,379,0,0,340,99,385,300},
    {0,0,336,170,527,544,552,402,497,241,0,0,391,60,451,288},
    {0,0,89,48,487,339,565,400,406,218,0,0,550,108,381,186},
    {0,0,202,143,576,255,379,453,327,158,0,0,429,37,337,189},
    {0,0,194,80,382,408,396,290,367,388,0,0,346,89,409,290},
    {0,0,257,133,469,240,463,391,485,267,0,0,498,93,419,310},
    {0,0,82,64,527,358,579,418,378,217,0,0,610,134,365,195},
    {0,0,155,88,581,255,466,455,330,186,0,0,394,29,336,162},
    {0,0,210,90,363,416,395,274,331,411,0,0,373,112,341,319},
    {0,0,253,137,538,238,423,384,420,257,0,0,467,80,390,273},
    {0,0,8,0,478,320,511,416,370,221,0,0,630,128,395,218},



    {0,0,110,81,553,208,397,496,295,158,0,0,628,83,397,169},
    {0,0,215,82,369,380,402,245,334,427,0,0,373,110,354,285},
    {0,0,207,101,470,292,472,406,457,254,0,0,563,98,379,266},
    {0,0,7,11,560,336,589,450,336,190,0,0,637,132,396,183},
    {0,0,182,100,511,237,441,494,298,144,0,0,645,81,393,176},
    {0,0,198,96,368,390,399,245,323,409,0,0,364,105,338,292},
    {0,0,210,134,528,306,438,414,444,246,0,0,610,103,387,265},
    {0,0,0,0,490,377,542,410,430,254,0,0,673,161,322,163},
    {0,0,128,82,483,256,416,453,324,174,0,0,674,86,375,174},
    {0,0,205,82,383,399,398,249,336,418,0,0,375,115,363,292},
    {0,0,222,139,476,273,432,377,414,256,0,0,578,87,382,287},
    {0,0,0,15,501,333,566,440,367,198,0,0,601,137,365,194},
    {0,0,154,110,483,223,411,464,302,189,0,0,651,89,395,176},
    {0,0,202,54,350,390,398,256,346,429,0,0,365,101,342,304},
    {0,0,214,125,435,267,453,352,453,256,0,0,581,98,395,272},
    {0,0,64,43,460,334,559,406,379,201,0,0,624,116,400,193},
    {0,0,144,112,560,233,419,511,345,169,0,0,453,42,389,144},
    {0,0,211,98,368,401,371,288,330,384,0,0,368,112,337,291},
    {0,0,208,131,490,310,543,415,485,282,0,0,425,58,343,247},
    {0,0,0,0,542,372,542,435,342,197,0,0,571,140,375,182},



    {0,0,64,48,498,250,500,507,272,150,0,0,623,85,400,144},
    {0,0,201,94,359,387,370,270,330,370,0,0,360,130,313,287},
    {0,0,155,96,448,289,507,400,442,296,0,0,558,121,365,250},
    {0,0,0,0,511,368,599,447,365,219,0,0,615,154,336,176},
    {0,0,107,75,499,234,448,527,315,151,0,0,617,79,386,152},
    {0,0,191,64,376,405,399,268,336,385,0,0,352,118,338,287},
    {0,0,159,97,467,299,554,421,445,271,0,0,528,99,331,250},
    {0,0,17,28,501,347,554,441,400,227,0,0,599,146,370,183},
    {0,0,89,74,504,229,457,522,304,143,0,0,634,84,402,160},
    {0,0,199,84,353,399,375,279,313,368,0,0,355,69,320,265},
    {0,0,157,123,528,310,483,395,474,270,0,0,580,77,414,272},
    {0,0,0,0,466,327,562,419,396,217,0,0,597,135,368,192},
    {0,0,64,54,482,244,465,468,368,171,0,0,619,91,417,176},
    {0,0,206,92,355,384,365,272,332,379,0,0,357,127,326,258},
    {0,0,144,117,469,283,476,400,443,257,0,0,570,113,345,240},
    {0,0,16,31,527,305,574,435,352,189,0,0,592,138,364,183},
    {0,0,114,94,528,237,443,482,336,167,0,0,644,84,420,168},
    {0,0,208,90,364,401,368,282,339,382,0,0,373,124,368,275},
    {0,0,148,112,470,320,488,366,448,265,0,0,570,122,391,255},
    {0,0,0,3,553,375,619,442,441,235,0,0,602,119,362,184},


    {0,0,80,70,523,238,447,499,342,184,0,0,610,80,400,177},
    {0,0,203,105,336,368,359,288,330,355,0,0,354,131,347,282},
    {0,0,146,127,448,295,477,394,432,241,0,0,583,108,387,257},
    {0,0,17,55,592,349,576,477,372,189,0,0,620,129,387,188},
    {0,0,144,83,543,199,426,545,336,141,0,0,609,69,371,176},
    {0,0,207,98,359,391,356,259,336,362,0,0,357,114,361,256},
    {0,0,147,128,460,272,457,313,453,240,0,0,590,119,414,254},
    {0,0,0,4,495,342,542,429,448,233,0,0,612,138,369,205},
    {0,0,172,130,574,235,465,490,319,208,0,0,376,21,402,162},
    {0,0,213,78,373,445,418,283,351,428,0,0,380,80,400,325},
    {0,0,220,137,481,304,496,421,448,248,0,0,375,46,457,259},
    {0,0,29,14,498,383,585,405,383,243,0,0,560,108,439,197},
    {0,0,117,91,524,234,429,478,291,170,0,0,425,33,452,167},
    {0,0,208,80,362,399,406,276,337,418,0,0,384,100,395,325},
    {0,0,174,86,481,276,483,417,431,251,0,0,498,86,458,262},
    {0,0,1,0,528,375,610,400,355,239,0,0,584,128,391,221},
    {0,0,128,32,495,285,450,432,348,196,0,0,558,79,490,199},
    {0,0,195,80,330,400,389,269,308,400,0,0,374,100,368,308},
    {0,0,192,102,555,272,495,426,448,245,0,0,400,55,432,269},
    {0,0,0,0,486,371,576,417,340,221,0,0,590,112,432,208},


    {0,0,112,75,574,289,446,459,340,172,0,0,566,69,454,174},
    {0,0,206,96,329,390,368,257,307,378,0,0,338,101,337,304},
    {0,0,141,92,524,308,434,400,434,244,0,0,570,106,459,263},
    {0,0,0,0,560,359,538,417,385,231,0,0,561,122,434,196},
    {0,0,95,57,606,305,502,471,337,194,0,0,625,93,413,165},
    {0,0,192,89,327,372,350,246,304,384,0,0,355,105,341,285},
    {0,0,144,99,475,288,450,373,407,256,0,0,560,95,450,272},
    {0,0,0,0,560,353,545,406,355,237,0,0,606,138,457,257},
    {0,0,93,82,576,300,457,463,334,166,0,0,570,73,446,174},
    {0,0,190,82,337,377,384,269,314,390,0,0,378,122,358,295},
    {0,0,147,80,526,312,457,405,464,286,0,0,638,128,455,275},
    {0,0,0,17,509,390,528,415,354,212,0,0,657,128,425,177},
    {0,0,145,95,588,273,395,444,385,187,0,0,495,48,434,167},
    {0,0,190,90,396,373,387,251,322,385,0,0,357,100,384,282},
    {0,0,192,113,463,281,471,400,458,267,0,0,487,80,432,282},
    {0,0,16,26,485,347,496,400,422,206,0,0,582,114,495,208},
    {0,0,87,65,487,215,544,533,231,138,0,0,458,20,329,144},
    {0,0,227,84,391,460,365,301,356,373,0,0,400,87,374,280},
    {0,0,208,112,527,221,467,371,448,276,0,0,419,57,373,208},
    {0,0,0,0,577,337,487,436,336,219,0,0,538,112,379,176}

 };

int trainLabels[200] = {

  1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,   1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,
  1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,   1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,
  1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,   1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,
  1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,   1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,
  1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,   1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4
  };


//A is middle, B is pointer, C is ring, D is pinky, E is fold, F is digits
float AOpen  = 10.6,  BOpen  = 10.2,  COpen  = 10.3, DOpen  = 9.5, EOpen  = 10.2, FOpen  = 0.8;
float AMid   = 9.5, BMid   = 9.0, CMid   = 11.4, DMid   = 10.5, EMid   = 9.8, FMid   = 0.35;
float AClose = 8.5, BClose = 7.9, CClose = 12.5,  DClose = 11.6, EClose = 9.5, FClose = 0.2;



void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);

  //led setup
  pinMode(2,OUTPUT);
  pinMode(15,OUTPUT);
  digitalWrite(2,LOW);
  digitalWrite(15,LOW);

  WiFi.mode(WIFI_STA);
  //initialize espNOW
  if (esp_now_init() != ESP_OK) {
    Serial.println("Error initializing ESP-NOW");
    return;
  }
  esp_now_register_send_cb(OnDataSent);

  // Register peer
  memcpy(peerInfo.peer_addr, broadcastAddress, 6);
  peerInfo.channel = 0;  
  peerInfo.encrypt = false;
  // Add peer        
  if (esp_now_add_peer(&peerInfo) != ESP_OK){
    Serial.println("Failed to add peer");
    return;
  }

  pinMode(line1,INPUT);
  pinMode(line2,INPUT);
  pinMode(line3,INPUT);

  pinMode(output1,OUTPUT);
  pinMode(output2,OUTPUT);
  pinMode(output3,OUTPUT);
  pinMode(output4,OUTPUT);
  pinMode(output5,OUTPUT);
  pinMode(output6,OUTPUT);
  pinMode(output7,OUTPUT);
  pinMode(output8,OUTPUT);

}

void loop() {
  // put your main code here, to run repeatedly:
  // set all outs to low initially
  digitalWrite(output1,LOW);
  digitalWrite(output2,LOW);
  digitalWrite(output3,LOW);
  digitalWrite(output4,LOW);
  digitalWrite(output5,LOW);
  digitalWrite(output6,LOW);
  digitalWrite(output7,LOW);
  digitalWrite(output8,LOW);

  delay(5);

  // read column 1
  digitalWrite (output1,HIGH);
  delay(5);
  completeArray[0] = analogRead (line2);  completeArray[1] = analogRead (line3);  
  delay(2);
  digitalWrite(output1,LOW);

  // read column 2
  digitalWrite (output2,HIGH);
  delay(5);
  completeArray[2] = analogRead (line2);  completeArray[3] = analogRead (line3); 
  delay(2);
  digitalWrite(output2,LOW);

  // read column 3
  digitalWrite (output3,HIGH);
  delay(5);
  completeArray[4] = analogRead (line2);  completeArray[5] = analogRead (line3);  
  delay(2);
  digitalWrite(output3,LOW);

  // read column 4
  digitalWrite (output4,HIGH);
  delay(5);
  completeArray[6] = analogRead (line2);  completeArray[7] = analogRead (line3); 
  delay(2);
  digitalWrite(output4,LOW);

  // read column 5
  digitalWrite (output5,HIGH);
  delay(5);
  completeArray[8] = analogRead (line2);  completeArray[9] = analogRead (line3); 
  delay(2);
  digitalWrite(output5,LOW);

  // read column 6
  digitalWrite (output6,HIGH);
  delay(5);
  completeArray[10] = analogRead (line2);  completeArray[11] = analogRead (line3); 
  delay(2);
  digitalWrite(output6,LOW);

  // read column 7
  digitalWrite (output7,HIGH);
  delay(5);
  completeArray[12] = analogRead (line2);  completeArray[13] = analogRead (line3); 
  delay(2);
  digitalWrite(output7,LOW);

  // read column 8
  digitalWrite (output8,HIGH);
  delay(5);
  completeArray[14] = analogRead (line2);  completeArray[15] = analogRead (line3);  
  delay(2);
  digitalWrite(output8,LOW);

  for (int i = 0; i<16; i++){ avg = avg + completeArray[i]; }
  avg = avg/16;


  //find distance between new point and all training data
  int distances[200];

  for (int i=0; i<200; i++){
    distances[i] = manhDist(trainData[i],completeArray);
  }
  //find  smallest distances (k=1)

  int smallestDist = distances[0];
  int smallestLabel = trainLabels[0];

  for (int i=0;i<200;i++){
    if (distances[i]<smallestDist){
      smallestDist = distances[i];
      smallestLabel = trainLabels[i];
    }

  }

  //change LEDs based on gesture
  if (smallestLabel == 1){ digitalWrite(15,LOW); digitalWrite(2,LOW);}    //open,  both off
  if (smallestLabel == 2){ digitalWrite(15,HIGH); digitalWrite(2,HIGH);}  // close, both on
  if (smallestLabel == 3){ digitalWrite(15,LOW); digitalWrite(2,HIGH);}   //point, blue on
  if (smallestLabel == 4){ digitalWrite(15,HIGH); digitalWrite(2,LOW);}   // pinch, red on

  float Adest = AOpen;
  float Bdest = BOpen; 
  float Cdest = COpen;
  float Ddest = DOpen;
  float Edest = EOpen;
  float Fdest = FOpen;

  if(smallestLabel == 1){Adest = AOpen; Bdest = BOpen; Cdest = COpen; Ddest = DOpen; Edest = EOpen; Fdest = FOpen;}
  if(smallestLabel == 2){Adest = AClose; Bdest = BClose; Cdest = CClose; Ddest = DClose; Edest = EClose; Fdest = FClose;}
  if(smallestLabel == 3){Adest = AClose; Bdest = BOpen; Cdest = CClose; Ddest = DClose; Edest = EOpen; Fdest = FClose;}
  if(smallestLabel == 4){Adest = AMid; Bdest = BMid; Cdest = COpen; Ddest = DOpen; Edest = EClose; Fdest = FMid;}

  myData.Adest = Adest; myData.Bdest = Bdest; myData.Cdest = Cdest; myData.Ddest = Ddest; myData.Edest = Edest; myData.Fdest = Fdest;

  esp_err_t result = esp_now_send(broadcastAddress, (uint8_t *) &myData, sizeof(myData));
  if (result == ESP_OK) {  Serial.println("Sent with success");  }
  else { Serial.println("Error sending the data");  }

  delay(10);

}



